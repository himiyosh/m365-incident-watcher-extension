# M365 Incident Watcher

Microsoft 365 管理センター（lynx.office.net）のインシデントの更新を監視し、変更があった場合にデスクトップ通知でお知らせするChrome拡張機能です。

## 概要

Microsoft 365 のシステム管理者は、サービスのインシデントやアドバイザリの状況を常に把握する必要があります。しかし、ブラウザで管理ページを何度もリロードして確認するのは手間がかかります。

この拡張機能は、指定したインシデントIDのページをバックグラウンドで定期的にチェックし、内容に更新があった場合にのみ通知を送信します。これにより、インシデントの変更に素早く気づき、対応することができます。

## 主な機能

-   **インシデントの自動監視**: 監視したいインシデントのIDを複数指定できます。
-   **デスクトップ通知**: インシデントの「最終更新日時」に変更があった場合に通知します。
-   **柔軟な設定**: 監視間隔を分単位で設定できます。
-   **手動チェック**: 必要なタイミングで即座に更新を確認できます。
-   **更新内容のプレビュー**: ポップアップから、前回と今回のスナップショットを比較できます（テキスト差分、HTML表示）。

## 使い方

1.  Chromeに拡張機能を追加します。
2.  ツールバーの拡張機能アイコンをクリックして、ポップアップを開きます。
3.  テキストエリアに監視したいインシデントID（例: `TM1234567`）を、改行、スペース、またはカンマで区切って入力します。
4.  「チェック間隔」を分単位で設定します。
5.  「バックグラウンドで監視する」にチェックが入っていることを確認します。
6.  「保存」ボタンをクリックします。設定が保存され、監視が開始されます。

ポップアップ下部のテーブルに、各インシデントの最終チェック日時や状態が表示されます。

## 仕組み（技術的な詳細）

この拡張機能は、標準的なChrome拡張機能のアーキテクチャで構成されています。

-   `background.js` (Service Worker):
    -   `chrome.alarms` API を使用して、指定された間隔で定期的なチェック処理を起動します。
    -   監視対象のインシデントを一つずつキューで処理します。
    -   対象のインシデントページを非アクティブなタブで開き、`content-script.js` を挿入して情報を取得します。
    -   取得した情報（最終更新日時）を前回と比較し、変更があればデスクトップ通知を送信します。
    -   設定や過去のスナップショットデータは `chrome.storage` に保存されます。

-   `content-script.js`:
    -   インシデントページが完全に読み込まれるのを待機します。
    -   ページからインシデントのタイトル、最終更新日時、本文テキスト、HTMLを抽出します。
    -   抽出した情報を `background.js` にメッセージとして送信します。

-   `popup.js`:
    -   ユーザーインターフェース（設定画面やステータス表示）を制御します。
    -   ユーザーの操作に応じて `background.js` に処理を依頼します。
    -   `background.js` が保持する最新の状態を読み込んで表示します。
